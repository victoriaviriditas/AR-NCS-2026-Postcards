<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NCS 24th Biennial – AR Postcard Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <!-- A-Frame + MindAR (image tracking) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: Helvetica, Arial, sans-serif;
      background: #000;
      color: #fff;
    }

    /* Fullscreen AR container */
    #ar-container {
      position: fixed;
      inset: 0;
    }

    /* Start button overlay */
    #ui-start {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(255,255,255,0.12), rgba(0,0,0,0.95));
      z-index: 20;
    }

    #ui-start button {
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-family: inherit;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      background: #c1503c;
      color: #fff;
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
      transition: transform 0.15s ease-out, box-shadow 0.15s ease-out, opacity 0.25s ease-out;
    }

    #ui-start button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 16px rgba(0,0,0,0.6);
    }

    #ui-start.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* Text overlay that appears when the postcard is detected */
    #overlay {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 1.5rem;
      box-sizing: border-box;
      pointer-events: none; /* allow camera interactions only */
      z-index: 10;
      opacity: 0;
      transition: opacity 0.4s ease-out;
    }

    #overlay.visible {
      opacity: 1;
    }

    .overlay-inner {
      max-width: 720px;
      width: 100%;
      background: rgba(0, 0, 0, 0.45);
      border-radius: 24px;
      padding: 1.75rem 1.5rem;
      backdrop-filter: blur(10px);
      box-shadow: 0 24px 60px rgba(0,0,0,0.75);
    }

    /* Main title (welcome text) */
    #welcome-text {
      font-size: clamp(1.1rem, 2.4vw, 1.5rem);
      line-height: 1.5;
      font-weight: 500;
      margin-bottom: 1.25rem;
      text-transform: none;
      letter-spacing: 0.03em;
      display: inline-block;
      white-space: normal;
    }

    /* Each letter will be wrapped in a span for the left-to-right fade */
    #welcome-text span {
      opacity: 0;
      transform: translateY(0.25em);
      display: inline-block;
      animation: letterFade 0.7s forwards;
    }

    @keyframes letterFade {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Secondary line that changes text every 3 seconds */
    #session-line {
      font-size: clamp(0.95rem, 2vw, 1.2rem);
      font-weight: 400;
      margin-top: 0.25rem;
      min-height: 1.2em;
      opacity: 0;
      transform: translateY(0.25em);
      transition: opacity 0.3s ease-out, transform 0.3s ease-out;
    }

    #session-line.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Little hint at the bottom */
    #hint {
      margin-top: 1rem;
      font-size: 0.75rem;
      opacity: 0.75;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    /* Fallback message if camera permission fails */
    #error-message {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      text-align: center;
      background: #111;
      color: #fff;
      z-index: 30;
    }

    #error-message.visible {
      display: flex;
    }

    #error-message p {
      max-width: 420px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div id="ar-container">
    <!-- A-Frame / MindAR AR scene -->
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; autoStart: false;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights: true, logarithmicDepthBuffer: true"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      embedded
      id="scene">

      <a-assets>
        <!-- Optionally keep a copy of the postcard image here (not required for tracking itself) -->
        <!-- <img id="postcard" src="./Copy-of-AR-Postcard-1.png" /> -->
      </a-assets>

      <!-- Camera for MindAR -->
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- We don't need to display anything in 3D for this version;
           we just use the image-target events to drive the HTML overlay. -->
      <a-entity mindar-image-target="targetIndex: 0" id="postcard-target"></a-entity>
    </a-scene>
  </div>

  <!-- Start UI (user tap to allow camera) -->
  <div id="ui-start">
    <button id="start-button">Start AR Experience</button>
  </div>

  <!-- Text overlay -->
  <div id="overlay">
    <div class="overlay-inner">
      <div id="welcome-text"></div>
      <div id="session-line"></div>
      <div id="hint">Point your camera at the postcard front to keep the text anchored.</div>
    </div>
  </div>

  <!-- Error message -->
  <div id="error-message">
    <p>
      We couldn’t access your camera. Please make sure you’ve allowed camera permissions in your browser,
      then refresh this page.
    </p>
  </div>

  <script>
    // === Configuration ===

    const WELCOME_MESSAGE =
      "Welcome to the 24th Biennial Congress of the New Chaucer Society.";

    // Session titles for Day 1.
    // TODO: Replace these placeholders with the actual session titles from your programme.
   const SESSION_TITLES = [
  "Today, we have",
  "Queer Medieval Ecologies (CE)",
  "Medieval Age I: Childhood, Childishness, and Infantilization in Medieval Literature",
  "Varieties of English Religious Experience",
  "Literature and Medieval Scientific Knowledge",
  "Modernist Medievalisms",
  "The Time of Adaptations",
  "Making Sense of Medieval Faces I",
  "It’s Not Boring, It’s…: Why Do We Teach Old Stuff? (Tw/tMLT)",
  "It’s Not Boring, It’s…: Why Do–Or Should–We Teach Literature? (Tw/tMLT)",
  "Medieval Age II: Age and Aging in Late Medieval Literature",
  "Nineteenth-Century Medievalisms",
  "Making Sense of Medieval Faces II",
  "Piety in Late Medieval England I",
  "Limits of Translation",
  "Medieval Anticlimax I (Pre)",
  "Dramatic Ecologies (CE)",
  "Understanding the Colonizer/Re-Imagining the Medieval I: Indigenous Medievalism (UM)",
  "Stones and Bones in Medieval European Literature I (CE)",
  "Middle English Beyond French and Latin I: The Politics of Language (MM)",
  "Medieval Anticlimax II (Pre)",
  "Piety in Late Medieval England II",
  "Medieval Temporalities I: Synchronous and Asynchronous Times",
  "The Debating Game: Rhetoric, Play, and Performativity (Tw/tMLT)",
  "The Craft So Fast to Learn: Modular Haiku Comics"
];

    const SESSION_INTERVAL_MS = 3000; // 3 seconds

    // === Text animation helpers ===

    function buildWelcomeText() {
      const container = document.getElementById("welcome-text");
      container.innerHTML = "";
      const chars = WELCOME_MESSAGE.split("");
      chars.forEach((ch, index) => {
        const span = document.createElement("span");
        span.textContent = ch;
        // stagger so it fades left-to-right
        const delay = 0.03 * index; // seconds
        span.style.animationDelay = delay + "s";
        container.appendChild(span);
      });
    }

    function startSessionTicker() {
      const sessionLine = document.getElementById("session-line");
      let index = 0;

      function showNext() {
        sessionLine.classList.remove("visible");
        // small timeout to let fade-out (if any) happen
        setTimeout(() => {
          sessionLine.textContent = SESSION_TITLES[index];
          sessionLine.classList.add("visible");
          index = (index + 1) % SESSION_TITLES.length;
        }, 250);
      }

      // initial delay gives the welcome text a moment to complete its fade
      setTimeout(() => {
        showNext();
        setInterval(showNext, SESSION_INTERVAL_MS);
      }, 2000);
    }

    // === AR / MindAR handling ===

    window.addEventListener("load", () => {
      const sceneEl = document.getElementById("scene");
      const startButton = document.getElementById("start-button");
      const startOverlay = document.getElementById("ui-start");
      const htmlOverlay = document.getElementById("overlay");
      const errorMessage = document.getElementById("error-message");
      const targetEntity = document.getElementById("postcard-target");

      buildWelcomeText();
      startSessionTicker();

      // Start AR on button tap (required on iOS / many mobile browsers)
      startButton.addEventListener("click", async () => {
        try {
          const mindarSystem = sceneEl.systems["mindar-image-system"];
          await mindarSystem.start();   // this triggers camera access & tracking
          startOverlay.classList.add("hidden");
        } catch (err) {
          console.error(err);
          errorMessage.classList.add("visible");
        }
      });

      // When the postcard image is detected, show the overlay.
      targetEntity.addEventListener("targetFound", () => {
        htmlOverlay.classList.add("visible");
      });

      // When tracking is lost, you can either hide or keep the overlay.
      // Here we fade it out when the postcard is no longer visible.
      targetEntity.addEventListener("targetLost", () => {
        htmlOverlay.classList.remove("visible");
      });
    });
  </script>
</body>
</html>
