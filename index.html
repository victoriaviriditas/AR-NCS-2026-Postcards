<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>NCS 24th Biennial – AR Postcard Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <!-- A-Frame + MindAR (image tracking) -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      font-family: Helvetica, Arial, sans-serif;
      background: #000;
      color: #fff;
    }

    #ar-container {
      position: fixed;
      inset: 0;
    }

    /* Start button overlay */
    #ui-start {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(255,255,255,0.12), rgba(0,0,0,0.95));
      z-index: 20;
      transition: opacity 0.25s ease-out;
    }

    #ui-start.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #ui-start button {
      padding: 1rem 2.5rem;
      font-size: 1.1rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-family: inherit;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      background: #c1503c;
      color: #fff;
      box-shadow: 0 10px 30px rgba(0,0,0,0.45);
      transition: transform 0.15s ease-out, box-shadow 0.15s ease-out, opacity 0.25s ease-out;
    }

    #ui-start button:active {
      transform: translateY(1px) scale(0.98);
      box-shadow: 0 6px 16px rgba(0,0,0,0.6);
    }

    /* Error message if camera fails */
    #error-message {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      text-align: center;
      background: #111;
      color: #fff;
      z-index: 30;
    }

    #error-message.visible {
      display: flex;
    }

    #error-message p {
      max-width: 420px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div id="ar-container">
    <!-- A-Frame / MindAR AR scene -->
    <a-scene
      mindar-image="imageTargetSrc: ./targets.mind; autoStart: false;"
      color-space="sRGB"
      renderer="colorManagement: true, physicallyCorrectLights: true, logarithmicDepthBuffer: true"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false"
      embedded
      id="scene">

      <!-- Camera for MindAR -->
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Image target with 3D text children -->
      <a-entity mindar-image-target="targetIndex: 0" id="postcard-target">

        <!-- Main welcome text (3D, anchored above centre of postcard) -->
        <a-entity
          id="welcomeText3D"
          position="0 0.25 0"
          text="value: ; align: center; color: #FFFFFF; width: 1.8; wrapCount: 40"
          material="opacity: 0; transparent: true"
          animation__fadein="property: material.opacity; from: 0; to: 1; dur: 2000; easing: easeOutQuad; startEvents: fadein">
        </a-entity>

        <!-- Changing session line underneath -->
        <a-entity
          id="sessionText3D"
          position="0 -0.05 0"
          text="value: ; align: center; color: #FFFFFF; width: 1.8; wrapCount: 40"
          material="opacity: 0; transparent: true"
          animation__fadein="property: material.opacity; from: 0; to: 1; dur: 400; easing: easeOutQuad; startEvents: fadein"
          animation__fadeout="property: material.opacity; from: 1; to: 0; dur: 250; easing: easeInQuad; startEvents: fadeout">
        </a-entity>

      </a-entity>
    </a-scene>
  </div>

  <!-- Start UI (user tap to allow camera) -->
  <div id="ui-start">
    <button id="start-button">Start AR Experience</button>
  </div>

  <!-- Error message -->
  <div id="error-message">
    <p>
      We couldn’t access your camera. Please make sure you’ve allowed camera permissions in your browser,
      then refresh this page.
    </p>
  </div>

  <script>
    // === Configuration ===

    const WELCOME_MESSAGE =
      "Welcome to the 24th Biennial Congress of the New Chaucer Society.";

    const SESSION_TITLES = [
      "Today, we have",
      "Queer Medieval Ecologies (CE)",
      "Medieval Age I: Childhood, Childishness, and Infantilization in Medieval Literature",
      "Varieties of English Religious Experience",
      "Literature and Medieval Scientific Knowledge",
      "Modernist Medievalisms",
      "The Time of Adaptations",
      "Making Sense of Medieval Faces I",
      "It’s Not Boring, It’s…: Why Do We Teach Old Stuff? (Tw/tMLT)",
      "It’s Not Boring, It’s…: Why Do–Or Should–We Teach Literature? (Tw/tMLT)",
      "Medieval Age II: Age and Aging in Late Medieval Literature",
      "Nineteenth-Century Medievalisms",
      "Making Sense of Medieval Faces II",
      "Piety in Late Medieval England I",
      "Limits of Translation",
      "Medieval Anticlimax I (Pre)",
      "Dramatic Ecologies (CE)",
      "Understanding the Colonizer/Re-Imagining the Medieval I: Indigenous Medievalism (UM)",
      "Stones and Bones in Medieval European Literature I (CE)",
      "Middle English Beyond French and Latin I: The Politics of Language (MM)",
      "Medieval Anticlimax II (Pre)",
      "Piety in Late Medieval England II",
      "Medieval Temporalities I: Synchronous and Asynchronous Times",
      "The Debating Game: Rhetoric, Play, and Performativity (Tw/tMLT)",
      "The Craft So Fast to Learn: Modular Haiku Comics"
    ];

    const SESSION_INTERVAL_MS = 3000; // 3 seconds

    let sessionTickerInterval = null;
    let tickerStarted = false;

    function startSessionTicker(sessionEntity) {
      if (tickerStarted) return;
      tickerStarted = true;

      let index = 0;

      function showNext() {
        // fade out, change text, fade in
        sessionEntity.emit("fadeout");
        setTimeout(() => {
          sessionEntity.setAttribute("text", "value", SESSION_TITLES[index]);
          sessionEntity.emit("fadein");
          index = (index + 1) % SESSION_TITLES.length;
        }, 260);
      }

      // slight delay so the welcome text can fade first
      setTimeout(() => {
        showNext();
        sessionTickerInterval = setInterval(showNext, SESSION_INTERVAL_MS);
      }, 2000);
    }

    window.addEventListener("load", () => {
      const sceneEl = document.getElementById("scene");
      const startButton = document.getElementById("start-button");
      const startOverlay = document.getElementById("ui-start");
      const errorMessage = document.getElementById("error-message");
      const targetEntity = document.getElementById("postcard-target");

      const welcomeText3D = document.getElementById("welcomeText3D");
      const sessionText3D = document.getElementById("sessionText3D");

      // Set the welcome message (spaces preserved normally here)
      welcomeText3D.setAttribute("text", "value", WELCOME_MESSAGE);

      // Start AR on button tap
      startButton.addEventListener("click", async () => {
        try {
          const mindarSystem = sceneEl.systems["mindar-image-system"];
          await mindarSystem.start();
          startOverlay.classList.add("hidden");
        } catch (err) {
          console.error(err);
          errorMessage.classList.add("visible");
        }
      });

      // When the postcard is found, show / animate the 3D text
      targetEntity.addEventListener("targetFound", () => {
        // Fade in welcome text
        welcomeText3D.emit("fadein");
        // Start the ticker for the line below
        startSessionTicker(sessionText3D);
      });

      // When postcard is lost, optionally stop ticker or fade text out
      targetEntity.addEventListener("targetLost", () => {
        // If you want the text to vanish when they move away:
        welcomeText3D.setAttribute("material", "opacity", 0);
        sessionText3D.setAttribute("material", "opacity", 0);
      });
    });
  </script>
</body>
</html>
